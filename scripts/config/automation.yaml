# AMI Automation Configuration
version: "2.0.0"

# Environment
environment: "${AMI_ENV:development}"

# Paths (all relative to ORCHESTRATOR_ROOT)
paths:
  logs: "logs"
  config: "config"
  cache: ".cache"

# Logging
logging:
  level: "INFO"
  format: "json"
  retention_days: 90

  # Transcript archival (per Claude Code docs)
  transcripts:
    enabled: true
    path: "logs/transcripts/{date:%Y-%m-%d}"
    compress: true

# Hooks (loaded from hooks.yaml)
hooks:
  file: "scripts/config/hooks.yaml"
  timeout: 30
  parallel: false

# Agent CLI settings (multi-provider support)
agent:
  provider: "claude"  # Global default provider: claude or gemini

  # Worker defaults (for task execution, code generation)
  worker:
    provider: "${AMI_AGENT_WORKER_PROVIDER:claude}"  # claude or gemini
    model: "${AMI_AGENT_WORKER_MODEL:}"  # Empty = use provider's model_default

  # Moderator defaults (for validation, verification)
  moderator:
    provider: "${AMI_AGENT_MODERATOR_PROVIDER:claude}"  # claude or gemini
    model: "${AMI_AGENT_MODERATOR_MODEL:}"  # Empty = use provider's model_default

  # Claude Code CLI settings
  claude:
    command: "{root}/.venv/node_modules/.bin/claude"  # Use venv Claude, not system
    model_default: "claude-sonnet-4-5"
    model_audit: "claude-sonnet-4-5"  # 100% accuracy requirement

  # Gemini CLI settings
  gemini:
    command: "gemini"  # Or: "{root}/.venv/node_modules/.bin/gemini"
    model_default: "gemini-2.5-pro"
    model_audit: "gemini-2.5-flash"  # Faster for hooks

# Legacy claude_cli config (for backward compatibility - will be deprecated)
claude_cli:
  command: "{root}/.venv/node_modules/.bin/claude"
  model_default: "claude-sonnet-4-5"
  model_audit: "claude-sonnet-4-5"

# MCP Servers (Model Context Protocol)
mcp:
  enabled: true
  servers:
    browser:
      command: "ami-run"
      args:
        - "{root}/browser/scripts/run_chrome.py"
        - "--data-root"
        - "{root}/browser/data"
    # Future: add more MCP servers as needed
    # database:
    #   command: "python3"
    #   args:
    #     - "{root}/database/scripts/mcp_server.py"

# Prompts
prompts:
  dir: "scripts/config/prompts"
  agent: "agent.txt"
  audit: "audit.txt"
  audit_diff: "audit_diff.txt"
  consolidate: "consolidate.txt"
  task_worker: "task_worker.txt"
  task_moderator: "task_moderator.txt"
  sync_worker: "sync_worker.txt"
  sync_moderator: "sync_moderator.txt"
  docs_worker: "docs_worker.txt"
  docs_moderator: "docs_moderator.txt"
  completion_moderator: "completion_moderator.txt"

# Response Scanner
response_scanner:
  completion_moderator_enabled: true  # Validate completion markers with moderator

# Research Validator
research_validator:
  skip_threshold_lines: 5  # Skip validation for diffs < 5 lines (trivial changes)
  lookback_messages: 30    # Check last 30 messages for research tools (WebFetch, Read, Grep)

# Audit
audit:
  patterns_dir: "scripts/config/patterns"
  parallel: true
  workers: 4
  cache:
    enabled: true
    storage: ".cache/audit"
    ttl: 3600

  scanning:
    include_patterns:
      - "**/*.py"
      - "**/*.js"
      - "**/*.ts"

    exclude_patterns:
      - "**/node_modules/**"
      - "**/__pycache__/**"
      - "**/.*"
      - "**/dist/**"
      - "**/build/**"
      - "**/venv/**"
      - "**/.venv/**"
      - "**/ux/ui-concept/**"

# Task Execution
tasks:
  parallel: false  # Sequential by default (async when true)
  workers: 4  # Parallel worker count (when parallel=true)
  timeout_per_task: 3600  # 1 hour max per task
  moderator_enabled: true  # Validate with moderator after worker completion

  include_patterns:
    - "**/*.md"

  exclude_patterns:
    - "**/README.md"
    - "**/CLAUDE.md"
    - "**/AGENTS.md"
    - "**/feedback-*.md"
    - "**/progress-*.md"
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/.venv/**"
    - "**/venv/**"
    - "**/__pycache__/**"
    - "**/*.egg-info/**"
    - "**/.cache/**"
    - "**/.pytest_cache/**"
    - "**/.mypy_cache/**"
    - "**/.ruff_cache/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/ux/ui-concept/**"

# Git Sync
sync:
  timeout: 1800  # 30 minutes max per module
  moderator_enabled: true  # Validate with moderator after worker completion

# Documentation Maintenance
docs:
  parallel: false  # Sequential by default (async when true)
  workers: 4  # Parallel worker count (when parallel=true)
  timeout_per_doc: 600  # 10 minutes max per doc
  moderator_enabled: true  # Validate with moderator after worker completion

  include_patterns:
    - "**/*.md"

  exclude_patterns:
    - "**/CLAUDE.md"      # Agent instructions
    - "**/AGENTS.md"      # Agent documentation
    - "**/archive/**"     # Already archived docs
    - "**/feedback-*.md"  # Task feedback files
    - "**/progress-*.md"  # Task progress files
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/.venv/**"
    - "**/venv/**"
    - "**/__pycache__/**"
    - "**/*.egg-info/**"
    - "**/.cache/**"
    - "**/.pytest_cache/**"
    - "**/.mypy_cache/**"
    - "**/.ruff_cache/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/ux/ui-concept/**"
